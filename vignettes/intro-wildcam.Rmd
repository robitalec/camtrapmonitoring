---
title: "Introduction to `wildcam`"
author: "Alec L. Robitaille"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```


<!-- ggplot2 figs with geom_sf -->

The {wildcam} package provides functions for planning and evaluating camera
trap surveys. The recommended approach is to first sample a set of candidate 
camera trap locations larger than the intended number of locations. Next, 
these candidate locations are evaluated using spatial layers to measure their
deployment feasibility (such as distance to road) and to quantify their bias 
and coverage of project-specific characteristics (such as placement across 
land cover classes). 

{wildcam} is designed to work with modern spatial R packages: {sf} and {terra}.

```{r}
library(wildcam)
library(sf)
library(terra)
```



## Sampling candidate camera trap locations

The `sample_ct` function returns candidate camera trap locations using 
`sf::st_sample` across the user's region of interest. Options include 
"regular", "random" or "hexagonal" sampling across the entire region of interest
or stratified by a column in the provided features. 

The example data "clearwater_lake_density" is a simulated species density 
grid near Clearwater Lake, Manitoba. It is a simple feature collection of 
polygons with a column named "density" (High, Medium, Low). 

We will randomly sample candidate camera trap locations, stratified by the 
simulated species density. 

```{r}
data("clearwater_lake_density")

plot(clearwater_lake_density)

pts <- sample_ct(
	clearwater_lake_density, 
	n = 25, 
	type = 'random', 
	col = 'density'
)

plot(pts)
```



## Evaluating candidate camera trap locations

To evaluate candidate camera trap locations, determine each spatial layer 
required and the criteria associated with it. For example:

Deployment feasibility

- elevation
	- measure: point sample
	- measure: buffered point sample
- roads
	- measure: distance to roads
	
Characteristics of candidate locations

- land cover
	- measure: point sample
- hydrology
	- measure: distance to major lakes
- wetlands
	- measure: distance to wetlands



### Deployment feasibility

First, we will evaluate the deployment feasibility layers. Note the elevation
example data is an external TIF file that can be loaded with the
{terra} package. 

The `eval_*` family of functions return the vector of values for each candidate
camera trap location. These vectors can be added to the simple features objects
using the common `df$name <- value` syntax. 

```{r}
# Load data
clearwater_lake_elevation_path <- system.file('extdata', 'clearwater_lake_elevation.tif', package = 'wildcam')
clearwater_lake_elevation <- rast(clearwater_lake_elevation_path)

data("clearwater_lake_roads")



# Evaluate elevation using point sample
pts$elev_pt <- eval_pt(clearwater_lake_elevation, pts)

# Evaluate elevation using buffered point sample
pts$elev_buffer_1e3 <- eval_buffer(clearwater_lake_elevation, pts, buffer_size = 1e3)

# Evaluate distance to roads
pts$road_dist <- eval_dist(clearwater_lake_roads, pts)



# Plot results
plot(pts)
```



# Load data
data(wetland)

# Evaluate each point with the wetland layer
points$wetland <- eval_buffer(x = points, layer = wetland, buffersize = 150, type = 'binary', direction = 'positive')

plot(points["wetland"])
```


# Select
```r
# Packages
library(data.table)

# Data
data(densitygrid)
data(lc)
data(dem)
data(wetland)

# Stratified random sampling
pts <- sample_ct(densitygrid, n = 5, type = 'random', col = 'density', returnDT = TRUE)

# Evaluate layers
pts[, lc := eval_pt(.SD, lc, type = 'categorical', direction = 'neutral', coords = c('X', 'Y'))]

pts[, dem := eval_buffer(.SD, dem, 100, type = 'real', direction = 'positive', coords = c('X', 'Y'))]

pts[, wetland := eval_buffer(.SD, wetland, 100, 'binary', 'negative', coords = c('X', 'Y'))]

# Select n locations
n <- 1

# TODO: fix type
# sel <- select_ct(pts, n, rank = c('wetland'), sub = expression(lc == 212), by = 'density')

```